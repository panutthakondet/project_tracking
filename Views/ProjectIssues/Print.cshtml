@model IEnumerable<ProjectTracking.Models.ProjectIssue>

@{
    Layout = null;

    string projectName = ViewBag.ProjectName as string ?? "All Projects";
    DateTime printDate = ViewBag.PrintDate != null
        ? (DateTime)ViewBag.PrintDate
        : DateTime.Now;

    var issues = Model ?? Enumerable.Empty<ProjectTracking.Models.ProjectIssue>();
    var totalReopen = issues.Sum(x => x.ReopenCount);
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Project Issues Report</title>

    <style>
        body { font-family: Tahoma, Arial; font-size: 11px; }

        h2 { text-align: center; margin-bottom: 5px; }

        .meta { margin-bottom: 10px; }

        table { width: 100%; border-collapse: collapse; }

        th, td {
            border: 1px solid #000;
            padding: 4px;
            vertical-align: top;
        }

        th { background: #eee; }

        .urgent { color: #c00000; font-weight: bold; }
        .normal { color: #333; }

        .reopen { color:#b8860b; font-weight:bold; }

        @@page {
            size: A4 portrait;
            margin: 10mm;
        }
    </style>
</head>

<body onload="window.print()">

<h2>üêû Project Issues Report</h2>

<div class="meta">
    <b>Project:</b> @projectName <br />
    <b>Printed:</b> @printDate.ToString("dd/MM/yyyy HH:mm") <br />
    <b>üîÅ Reopen Total:</b> <span class="reopen">@totalReopen ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
</div>

<table>
    <thead>
        <tr>
            <th style="width:60px;">ID</th>
            <th>Issue</th>
            <th style="width:160px;">Owner</th>
            <th style="width:100px;">Status</th>
            <th style="width:90px;">Priority</th>
            <th style="width:90px;">Reopen</th> <!-- ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏° -->
        </tr>
    </thead>
    <tbody>
    @if (!issues.Any())
    {
        <tr>
            <td colspan="6" style="text-align:center; color:#777; padding:10px;">
                ‚Äî No issue data ‚Äî
            </td>
        </tr>
    }
    else
    {
        foreach (var i in issues)
        {
            var urgent = i.IssuePriority == "URGENT";

            <tr>
                <td>@i.IssueId</td>
                <td>@i.IssueName</td>
                <td>@(i.Employee?.EmpName ?? "-")</td>
                <td>@i.IssueStatus</td>

                <td class="@(urgent ? "urgent" : "normal")">
                    @(urgent ? "‡∏î‡πà‡∏ß‡∏ô" : "‡∏õ‡∏Å‡∏ï‡∏¥")
                </td>

                <!-- ‚≠ê REOPEN -->
                <td class="reopen">
                    @(i.ReopenCount > 0 ? $"üîÅ {i.ReopenCount}" : "-")
                </td>
            </tr>
        }
    }
    </tbody>
</table>

</body>
</html>