@{
    ViewData["Title"] = "Create User";

    // Prefer ViewBag.Error, otherwise show TempData["Error"] if present
    string? error = (ViewBag.Error as string) ?? (TempData["Error"] as string);
    string? success = TempData["Success"] as string;

    // Repopulate inputs safely from ModelState (works for POST-back without using Request.Form)
    string Ms(string key) => ViewData.ModelState.TryGetValue(key, out var e) ? e.AttemptedValue ?? "" : "";

    var vUsername = Ms("username");
    var vEmail = Ms("email");
    var vRole = Ms("role");
    var vStatus = Ms("status");
}

<style>
/* ===== Page Header ===== */
.page-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
}
.page-title{
    display:flex;
    align-items:center;
    gap:10px;
}
.page-title h3{
    margin:0;
    font-weight:800;
}
.page-sub{
    margin-top:2px;
    color:#6b7280;
    font-size:12px;
}

/* ===== Card ===== */
.card-soft{
    border:0;
    border-radius:16px;
    box-shadow:0 10px 28px rgba(0,0,0,.08);
    overflow:hidden;
}
.card-soft .card-body{ padding:18px; }

/* ===== Form ===== */
.form-label{
    font-weight:700;
}
.form-text{
    color:#6b7280;
}
.req{
    color:#ef4444;
    font-weight:800;
    margin-left:4px;
}

/* ===== Input group ===== */
.eye-btn{
    border-top-right-radius:12px !important;
    border-bottom-right-radius:12px !important;
}
.rounded-12{
    border-radius:12px !important;
}
.input-group .form-control{
    border-top-left-radius:12px !important;
    border-bottom-left-radius:12px !important;
}

/* ===== Buttons ===== */
.btn-cta{
    border-radius:12px;
    font-weight:800;
    padding:.6rem 1rem;
}
.btn-soft{
    border-radius:12px;
    font-weight:700;
}

/* ===== Alert ===== */
.alert-soft{
    border-radius:14px;
    border:1px solid rgba(0,0,0,.06);
}

/* ===== Divider ===== */
.divider{
    height:1px;
    background:#eef2f7;
    margin:14px 0;
}

/* ===== Responsive ===== */
@@media (max-width: 575.98px){
    .page-head{ flex-direction:column; }
}
</style>

<div class="page-head">
    <div class="page-title">
        <div style="font-size:22px;">‚ûï</div>
        <div>
            <h3>Create User</h3>
            <div class="page-sub">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ Admin ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á)</div>
        </div>
    </div>

    <a asp-controller="UserManagement" asp-action="Index" class="btn btn-outline-secondary btn-soft">
        ‚Üê Back
    </a>
</div>

@if (!string.IsNullOrWhiteSpace(error))
{
    <div class="alert alert-danger alert-soft">@error</div>
}

@if (!string.IsNullOrWhiteSpace(success))
{
    <div class="alert alert-success alert-soft">@success</div>
}

<div class="card card-soft">
    <div class="card-body">
        <form asp-controller="UserManagement" asp-action="Create" method="post" autocomplete="off">
            @Html.AntiForgeryToken()

            <!-- USERNAME -->
            <div class="mb-3">
                <label class="form-label">
                    Username <span class="req">*</span>
                </label>
                <input name="username"
                       class="form-control rounded-12"
                       autocomplete="off"
                       placeholder="‡πÄ‡∏ä‡πà‡∏ô zewan"
                       value="@vUsername"
                       required />
            </div>

            <!-- EMAIL -->
            <div class="mb-3">
                <label class="form-label">
                    Email <span class="req">*</span>
                </label>
                <input name="email"
                       type="email"
                       class="form-control rounded-12"
                       placeholder="example@company.com"
                       autocomplete="email"
                       value="@vEmail"
                       required />
                <div class="form-text">
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ (‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô Login ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)
                </div>
            </div>

            <div class="divider"></div>

            <!-- PASSWORD -->
            <div class="mb-3">
                <label class="form-label">
                    Password <span class="req">*</span>
                </label>

                <div class="input-group">
                    <input id="passwordInput"
                           name="password"
                           type="password"
                           class="form-control"
                           autocomplete="new-password"
                           placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 8 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)"
                           required />
                    <button class="btn btn-outline-secondary eye-btn"
                            type="button"
                            onclick="togglePassword('passwordInput','eyeIcon1')"
                            aria-label="Toggle password visibility">
                        <span id="eyeIcon1">üëÅ</span>
                    </button>
                </div>

                <div class="form-text">
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö SHA-256 (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏Å‡∏ï‡∏¥)
                </div>
            </div>

            <!-- CONFIRM PASSWORD -->
            <div class="mb-3">
                <label class="form-label">
                    Confirm Password <span class="req">*</span>
                </label>

                <div class="input-group">
                    <input id="confirmPasswordInput"
                           name="confirmPassword"
                           type="password"
                           class="form-control"
                           autocomplete="new-password"
                           placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ã‡πâ‡∏≥‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"
                           required />
                    <button class="btn btn-outline-secondary eye-btn"
                            type="button"
                            onclick="togglePassword('confirmPasswordInput','eyeIcon2')"
                            aria-label="Toggle confirm password visibility">
                        <span id="eyeIcon2">üëÅ</span>
                    </button>
                </div>
            </div>

            <div class="divider"></div>

            <!-- ROLE / STATUS -->
            <div class="row g-2">
                <div class="col-md-6">
                    <label class="form-label">Role</label>
                    <select name="role" class="form-select rounded-12">
                        <option value="USER" selected="@(string.IsNullOrWhiteSpace(vRole) ? true : vRole.Equals("USER", StringComparison.OrdinalIgnoreCase))">USER</option>
                        <option value="ADMIN" selected="@(!string.IsNullOrWhiteSpace(vRole) && vRole.Equals("ADMIN", StringComparison.OrdinalIgnoreCase))">ADMIN</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select rounded-12">
                        <option value="ACTIVE" selected="@(string.IsNullOrWhiteSpace(vStatus) ? true : vStatus.Equals("ACTIVE", StringComparison.OrdinalIgnoreCase))">ACTIVE</option>
                        <option value="INACTIVE" selected="@(!string.IsNullOrWhiteSpace(vStatus) && vStatus.Equals("INACTIVE", StringComparison.OrdinalIgnoreCase))">INACTIVE</option>
                    </select>
                </div>
            </div>

            <!-- BUTTON -->
            <div class="d-flex flex-wrap gap-2 mt-4">
                <button class="btn btn-primary btn-cta" type="submit">üíæ Save</button>
                <a asp-controller="UserManagement" asp-action="Index" class="btn btn-outline-secondary btn-cta">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
<script>
    function togglePassword(inputId, iconId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        if (!input || !icon) return;

        const isPassword = input.type === "password";
        input.type = isPassword ? "text" : "password";
        icon.textContent = isPassword ? "üôà" : "üëÅ";
    }
</script>
}