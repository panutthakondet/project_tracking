@model ProjectTracking.Models.Meeting

@{
    ViewData["Title"] = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°";
    // Controller ‡∏™‡πà‡∏á ViewBag.Projects = list of { ProjectId, ProjectName }
    var projects = ViewBag.Projects as IEnumerable<dynamic>;
}

<style>
    .meeting-create-wrap { max-width: 980px; }
    .meeting-hero {
        border-radius: 16px;
        border: 1px solid rgba(0,0,0,.08);
        background: linear-gradient(180deg, rgba(13,110,253,.08), rgba(13,110,253,0));
        padding: 18px 18px 14px 18px;
        margin-bottom: 14px;
    }

    .meeting-hero__title { margin: 0; line-height: 1.2; }
    .meeting-hero__subtitle { margin: 6px 0 0 0; color: #6c757d; }

    .meeting-card {
        border-radius: 16px;
        overflow: hidden;
        border: 1px solid rgba(0,0,0,.08);
        box-shadow: 0 10px 28px rgba(0,0,0,.06);
        background: #fff;
    }

    .meeting-card__header {
        padding: 14px 16px;
        border-bottom: 1px solid rgba(0,0,0,.06);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .meeting-card__header .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(25,135,84,.10);
        color: #146c43;
        border: 1px solid rgba(25,135,84,.18);
        font-size: .92rem;
        white-space: nowrap;
    }

    .meeting-card__body { padding: 18px; }

    .section-title {
        margin: 0 0 8px 0;
        font-weight: 800;
        font-size: 1.02rem;
        color: rgba(0,0,0,.78);
    }

    .section-subtitle {
        margin: 0 0 12px 0;
        color: #6c757d;
        font-size: .93rem;
    }

    .req { color: #dc3545; font-weight: 700; }

    .form-hint {
        display: block;
        margin-top: 6px;
        color: #6c757d;
        font-size: .88rem;
    }

    .divider {
        height: 1px;
        background: rgba(0,0,0,.06);
        margin: 14px 0;
    }

    .btn-pill { border-radius: 999px; }

    @@media (max-width: 768px) {
        .meeting-card__body { padding: 14px; }
    }
</style>

<div class="container meeting-create-wrap">
    <div class="meeting-hero d-flex align-items-start justify-content-between gap-3">
        <div>
            <h2 class="meeting-hero__title">üìå @ViewData["Title"]</h2>
            <p class="meeting-hero__subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</p>
        </div>
        <div class="d-flex gap-2 flex-wrap">
            <a class="btn btn-outline-secondary btn-pill" href="/Meetings">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</a>
        </div>
    </div>

    <div class="meeting-card">
        <div class="meeting-card__header">
            <strong style="display:flex;align-items:center;gap:8px;">
                <span style="font-size:1.05rem;">üóìÔ∏è</span>
                <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</span>
            </strong>
            <span class="chip">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span>
        </div>

        <div class="meeting-card__body">
            <form method="post" action="/Meetings/Store" id="meetingForm">
                @Html.AntiForgeryToken()

                <h3 class="section-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                <p class="section-subtitle">‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πá‡πÑ‡∏î‡πâ)</p>

                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="req">*</span></label>
                        <input type="text" name="Title" class="form-control" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Kickoff, Sprint Planning" />
                        <small class="form-hint">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡πà‡∏≤‡∏¢</small>
                    </div>

                    <div class="col-12">
                        <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label>
                        <textarea name="Description" class="form-control" rows="3" placeholder="‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° / ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
                        <small class="form-hint">‡πÄ‡∏ä‡πà‡∏ô Agenda, ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°, ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                        <select name="ProjectId" class="form-select">
                            <option value="">‚Äî ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‚Äî</option>
                            @if (projects != null)
                            {
                                foreach (var p in projects)
                                {
                                    <option value="@p.ProjectId">@p.ProjectName</option>
                                }
                            }
                        </select>
                        <small class="form-hint">@((ViewBag.ProjectHint as string) ?? "")</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="req">*</span></label>
                        <input type="date" name="MeetingDate" value="@ViewBag.Date" class="form-control" required />
                        <small class="form-hint">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏° <span class="req">*</span></label>
                        <input type="time" name="StartTime" class="form-control" required />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î <span class="req">*</span></label>
                        <input type="time" name="EndTime" class="form-control" required />
                        <small class="form-hint" id="timeHint" style="display:none; color:#dc3545;">‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</small>
                    </div>

                    <div class="col-12">
                        <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                        <input type="text" name="Location" class="form-control" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° A / Google Meet" />
                        <small class="form-hint">‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏£‡∏∑‡∏≠ link ‡πÑ‡∏ß‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ</small>
                    </div>

                    <div class="col-12">
                        <label class="form-label">‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label>
                        @{
                            var employees = ViewBag.Employees as IEnumerable<dynamic> ?? Enumerable.Empty<dynamic>();
                        }
                        <select name="users" class="form-select" multiple size="8">
                            @foreach (var e in employees)
                            {
                                <option value="@e.EmpId">@e.EmpName @(e.Position != null ? $"({e.Position})" : "")</option>
                            }
                        </select>
                        <small class="form-hint">‡∏Å‡∏î Ctrl (Windows) / Cmd (Mac) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô</small>
                    </div>
                </div>

                <div class="divider"></div>

                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                    <div class="text-muted" style="font-size:.92rem;">
                        <span class="req">*</span> ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary btn-pill">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        <a href="/Meetings" class="btn btn-outline-secondary btn-pill">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
(function () {
    const form = document.getElementById('meetingForm');
    if (!form) return;

    const startInput = form.querySelector('input[name="StartTime"]');
    const endInput = form.querySelector('input[name="EndTime"]');
    const hint = document.getElementById('timeHint');

    function validateTime() {
        if (!startInput || !endInput) return true;
        if (!startInput.value || !endInput.value) {
            if (hint) hint.style.display = 'none';
            return true;
        }
        const ok = endInput.value > startInput.value;
        if (hint) hint.style.display = ok ? 'none' : 'block';
        return ok;
    }

    if (startInput) startInput.addEventListener('change', validateTime);
    if (endInput) endInput.addEventListener('change', validateTime);

    form.addEventListener('submit', function (e) {
        if (!validateTime()) {
            e.preventDefault();
            endInput?.focus();
        }
    });
})();
</script>